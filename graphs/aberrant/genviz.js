(function () {
  'use strict';

  const word_list = [
    "aberrant",
    "aberration",
    "abstain",
    "abstruse",
    "accolade",
    "acerbic",
    "acrimony",
    "adamant",
    "admonish",
    "admonitory",
    "aesthete",
    "aesthetic",
    "aesthetic",
    "amalgam",
    "ambiguous",
    "ambivalent",
    "ameliorate",
    "amenable",
    "amorphous",
    "anomalous",
    "anomaly",
    "antipathy",
    "antithetical",
    "apathetic",
    "apathy",
    "apocryphal",
    "appease",
    "arbitrary",
    "arcane",
    "arduous",
    "artful",
    "artful",
    "ascetic",
    "ascetic",
    "askance",
    "audacious",
    "audacity",
    "auspicious",
    "austere",
    "austere",
    "austere",
    "avaricious",
    "banal",
    "banality",
    "belie",
    "belligerent",
    "betray",
    "blatant",
    "bolster",
    "brazen",
    "bucolic",
    "bumbling",
    "burgeon",
    "calumny",
    "capricious",
    "castigate",
    "censure",
    "chastise",
    "chortle",
    "circumscribe",
    "circumvent",
    "commensurate",
    "concede",
    "concede",
    "concede",
    "confound",
    "confound",
    "conspicuous",
    "constituent",
    "constituent",
    "construe",
    "contingent",
    "contingent",
    "contrition",
    "contrive",
    "copious",
    "craven",
    "cryptic",
    "culminate",
    "culpability",
    "decorous",
    "decorum",
    "deferential",
    "deleterious",
    "delineate",
    "demur",
    "denigrate",
    "denote",
    "derivative",
    "derive",
    "derive",
    "dictatorial",
    "didactic",
    "diffident",
    "dilatory",
    "dilettante",
    "disaffected",
    "discrete",
    "disinterested",
    "dispassionate",
    "disseminate",
    "dogmatic",
    "duress",
    "eclectic",
    "economical",
    "edifying",
    "efficacious",
    "egregious",
    "elicit",
    "elucidate",
    "eminent",
    "enervate",
    "engender",
    "entrenched",
    "ephemeral",
    "equivocal",
    "eradicate",
    "erudite",
    "eschew",
    "esoteric",
    "espouse",
    "exacerbate",
    "exacting",
    "exalt",
    "exonerate",
    "expound",
    "extant",
    "fallacious",
    "fastidious",
    "flux",
    "foment",
    "forlorn",
    "forthcoming",
    "The",
    "forthcoming",
    "fortuitous",
    "frivolous",
    "frugal",
    "frustrate",
    "furtive",
    "gainsay",
    "gall",
    "gall",
    "galvanize",
    "garrulous",
    "gauche",
    "germane",
    "glut",
    "glut",
    "gossamer",
    "gregarious",
    "guileless",
    "hackneyed",
    "haphazard",
    "harangue",
    "harangue",
    "harried",
    "haughty",
    "hegemony",
    "heretic",
    "iconoclast",
    "iconoclastic",
    "idiosyncrasy",
    "ignoble",
    "ignominious",
    "immutable",
    "impartial",
    "impertinent",
    "implacable",
    "implausible",
    "imprudent",
    "impudent",
    "incisive",
    "incongruous",
    "incorrigible",
    "indecorous",
    "indifference",
    "inexorable",
    "ingenuous",
    "ingratiate",
    "inimical",
    "innocuous",
    "inscrutable",
    "insidious",
    "insolent",
    "intimate",
    "intransigent",
    "intrepid",
    "inveterate",
    "involved",
    "irrevocable",
    "itinerant",
    "jingoism",
    "jovial",
    "jubilant",
    "juxtapose",
    "laconic",
    "lambast",
    "languid",
    "largess",
    "laudable",
    "lionize",
    "magnanimous",
    "maintain",
    "maladroit",
    "maverick",
    "mawkish",
    "mendacity",
    "mercurial",
    "meticulous",
    "misconstrue",
    "mitigate",
    "mitigate",
    "mollify",
    "mundane",
    "mundane",
    "munificent",
    "myopic",
    "myriad",
    "negligible",
    "nonplussed",
    "nuance",
    "obscure",
    "obscure",
    "obsequious",
    "opaque",
    "opulence",
    "ostentatious",
    "ostracize",
    "panache",
    "parochial",
    "parsimonious",
    "pedantic",
    "pedestrian",
    "pejorative",
    "perfidy",
    "pernicious",
    "petulant",
    "placate",
    "platitude",
    "poignant",
    "polemic",
    "posit",
    "pragmatic",
    "precipitous",
    "preclude",
    "precocious",
    "predilection",
    "prescience",
    "prevaricate",
    "prodigal",
    "prodigious",
    "profligate",
    "profligate",
    "prolific",
    "propitious",
    "provincial",
    "pundit",
    "qualify",
    "qualify",
    "querulous",
    "quotidian",
    "ravenous",
    "rebuke",
    "reconcile",
    "recondite",
    "refractory",
    "refute",
    "reproach",
    "repudiate",
    "rescind",
    "restive",
    "resurgent",
    "reticent",
    "reverent",
    "rudimentary",
    "rustic",
    "sanction",
    "sanction",
    "scrupulous",
    "scrupulous",
    "soporific",
    "specious",
    "specious",
    "sporadic",
    "spurious",
    "staunch",
    "stringent",
    "subsume",
    "subsume",
    "subversive",
    "sullen",
    "superfluous",
    "superfluous",
    "supplant",
    "sycophant",
    "taciturn",
    "tantamount",
    "temperance",
    "tempered",
    "tenacious",
    "timorous",
    "torpor",
    "tortuous",
    "tractable",
    "transient",
    "travesty",
    "treacherous",
    "treacherous",
    "trite",
    "truncate",
    "undermine",
    "underscore",
    "unequivocal",
    "unscrupulous",
    "upbraid",
    "vacillate",
    "vehement",
    "venality",
    "venerate",
    "veracious",
    "vilify",
    "vindicate",
    "vociferous",
    "volubility",
    "wanting",
    "winsome",
    "aboveboard",
    "abysmal",
    "acme",
    "advocate",
    "advocate",
    "affable",
    "affluent",
    "altruism",
    "amiable",
    "amply",
    "amuck",
    "analogous",
    "animosity",
    "antedated",
    "antiquated",
    "apex",
    "aphorism",
    "aphoristic",
    "appreciable",
    "apprehension",
    "archaic",
    "ascendancy",
    "ascribe",
    "assail",
    "assuage",
    "augment",
    "autonomously",
    "avarice",
    "avert",
    "avert",
    "avid",
    "badger",
    "balk",
    "banish",
    "beatific",
    "becoming",
    "begrudge",
    "begrudge",
    "behooves",
    "belittle",
    "bellicose",
    "benign",
    "benign",
    "besiege",
    "besmirch",
    "bleak",
    "boon",
    "boon",
    "boorish",
    "brusquely",
    "buck",
    "buttress",
    "cadaverous",
    "candid",
    "candidness",
    "cardinal",
    "carping",
    "catalyst",
    "cavalier",
    "censor",
    "cerebral",
    "champion",
    "chauvinist",
    "check",
    "check",
    "checkered",
    "chivalrous",
    "clemency",
    "coalesce",
    "cogent",
    "cohesive",
    "collusion",
    "colossal",
    "commendable",
    "complacent",
    "complementary",
    "compound",
    "conducive",
    "conniving",
    "consecrate",
    "constraint",
    "consummate",
    "consummate",
    "contemptuous",
    "contrite",
    "conundrum",
    "convivial",
    "convoluted",
    "cornucopia",
    "corroborate",
    "cosmopolitan",
    "credence",
    "creditable",
    "credulity",
    "cumbersome",
    "dearth",
    "debase",
    "debunk",
    "decimation",
    "degrade",
    "delegate",
    "deliberate",
    "demean",
    "demure",
    "deride",
    "derisive",
    "derogative",
    "desecrate",
    "destitute",
    "destitute",
    "deter",
    "deter",
    "detrimental",
    "devolve",
    "devolve",
    "diabolical",
    "differentiate",
    "differentiate",
    "dilapidated",
    "diligent",
    "discord",
    "discreet",
    "discriminate",
    "disenfranchise",
    "disheartened",
    "disparate",
    "dispatch",
    "dispatch",
    "docile",
    "dog",
    "dupe",
    "dupe",
    "eccentric",
    "egotist",
    "eke",
    "elaborate",
    "elaborate",
    "elude",
    "elusive",
    "embellish",
    "embroiled",
    "empathetic",
    "emulate",
    "endemic",
    "enmity",
    "entice",
    "enumerate",
    "enumerate",
    "err",
    "errant",
    "erratic",
    "euphoria",
    "evasive",
    "evasive",
    "evenhanded",
    "exasperate",
    "excruciating",
    "exemplify",
    "exemplify",
    "exhort",
    "extenuating",
    "facetious",
    "fawn",
    "ferret",
    "fete",
    "fickle",
    "and",
    "finagle",
    "fledgling",
    "fleece",
    "flounder",
    "flush",
    "foible",
    "foolhardy",
    "forthright",
    "futile",
    "genial",
    "genteel",
    "glean",
    "glib",
    "goad",
    "grovel",
    "guffaw",
    "hamper",
    "hamstrung",
    "heyday",
    "hodgepodge",
    "hound",
    "humdrum",
    "illicit",
    "immaterial",
    "impeccable",
    "impede",
    "impending",
    "impermeable",
    "implicate",
    "implicate",
    "imponderable",
    "impregnable",
    "inadvertent",
    "inarticulate",
    "incense",
    "incessant",
    "inclement",
    "inclement",
    "incumbent",
    "indict",
    "indigenous",
    "indignant",
    "industrious",
    "inflammable",
    "ingenuity",
    "inkling",
    "insipid",
    "insolvent",
    "intermittent",
    "inundate",
    "irascible",
    "irk",
    "irresolute",
    "jargon",
    "jocular",
    "junta",
    "laborious",
    "leery",
    "lethargic",
    "lucid",
    "macabre",
    "malady",
    "malevolent",
    "malleable",
    "malleable",
    "malodorous",
    "martial",
    "maxim",
    "meander",
    "melancholy",
    "melee",
    "mesmerize",
    "misanthrope",
    "miscreant",
    "miser",
    "misogynist",
    "moment",
    "moot",
    "morose",
    "morph",
    "muted",
    "obdurate",
    "obliging",
    "obstinate",
    "ornate",
    "paradoxical",
    "pastoral",
    "patronize",
    "paucity",
    "peevish",
    "perennial",
    "perpetuate",
    "perquisite",
    "pertinent",
    "perturb",
    "peruse",
    "pine",
    "pinnacle",
    "piquant",
    "pithy",
    "pittance",
    "placid",
    "plodding",
    "ploy",
    "powwow",
    "precarious",
    "precedent",
    "preempt",
    "preemptive",
    "presumption",
    "presumption",
    "presumptuous",
    "made",
    "prevail",
    "prevail",
    "pristine",
    "pristine",
    "profuse",
    "Note:profusion",
    "proponent",
    "provisional",
    "pugnacious",
    "qualm",
    "quandary",
    "quip",
    "raffish",
    "raft",
    "rakish",
    "rankle",
    "rash",
    "redress",
    "relegate",
    "remiss",
    "renege",
    "replete",
    "reprobate",
    "reservation",
    "resignation",
    "resolve",
    "respite",
    "retiring",
    "retract",
    "rile",
    "robust",
    "sanctimonious",
    "sanguine",
    "savvy",
    "savvy",
    "savvy",
    "scintillating",
    "screed",
    "sentimental",
    "serendipity",
    "serene",
    "slapdash",
    "smattering",
    "smug",
    "snide",
    "snub",
    "sordid",
    "The",
    "spendthrift",
    "spurn",
    "squander",
    "staid",
    "start",
    "steadfast",
    "stem",
    "stipend",
    "stolid",
    "stymie",
    "summit",
    "summit",
    "surly",
    "tact",
    "tarnish",
    "tawdry",
    "taxing",
    "telling",
    "telltale",
    "tender",
    "thoroughgoing",
    "thrifty",
    "thwart",
    "tirade",
    "tout",
    "transitory",
    "travail",
    "tribulation",
    "tumult",
    "uncanny",
    "uncompromising",
    "unconscionable",
    "underwrite",
    "unnerve",
    "unprecedented",
    "unruly",
    "unseemly",
    "urbane",
    "vacuous",
    "vanquish",
    "variance",
    "veneer",
    "vicarious",
    "vie",
    "vindictive",
    "virago",
    "voracious",
    "wanton",
    "wax",
    "whimsical",
    "zenith",
    "abjure",
    "abrogate",
    "adjudicate",
    "afford",
    "alacrity",
    "anachronism",
    "anathema",
    "anemic",
    "anodyne",
    "anodyne",
    "antic",
    "aplomb",
    "apogee",
    "apostate",
    "apothegm",
    "apotheosis",
    "approbatory",
    "appropriate",
    "appropriate",
    "appurtenant",
    "arch",
    "arrant",
    "arriviste",
    "arrogate",
    "artifice",
    "artless",
    "artlessness",
    "asperity",
    "assiduously",
    "atavism",
    "attenuate",
    "autocratic",
    "autocratic",
    "baleful",
    "base",
    "bastardization",
    "beg",
    "bemoan",
    "benighted",
    "bereft",
    "bereft",
    "besotted",
    "besotted",
    "bilious",
    "blinkered",
    "bowdlerize",
    "bridle",
    "bridle",
    "bristle",
    "broadside",
    "bromide",
    "brook",
    "browbeat",
    "byzantine",
    "callow",
    "canard",
    "capitulate",
    "cataclysm",
    "catholic",
    "cede",
    "celerity",
    "chagrin",
    "chagrin",
    "charlatan",
    "chary",
    "chauvinism",
    "chimera",
    "choleric",
    "churlish",
    "complaisant",
    "complicit",
    "conciliate",
    "concomitant",
    "conflagration",
    "conflate",
    "contentious",
    "corollary",
    "cosseted",
    "coterminous",
    "countermand",
    "cow",
    "crestfallen",
    "crystallize",
    "cupidity",
    "curmudgeon",
    "debonair",
    "decry",
    "defray",
    "deign",
    "demonstrative",
    "denouement",
    "derelict",
    "derelict",
    "desiccated",
    "desideratum",
    "despot",
    "diatribe",
    "diminutive",
    "diminutive",
    "disabuse",
    "discursive",
    "disingenuous",
    "dispensation",
    "dissemble",
    "dissipate",
    "dissipate",
    "dissolution",
    "doleful",
    "dolorous",
    "doughty",
    "dovetail",
    "duplicity",
    "ebullient",
    "effervescent",
    "effrontery",
    "elegiac",
    "embryonic",
    "empiricism",
    "enamor",
    "encumber",
    "enjoin",
    "enormity",
    "enthrall",
    "epigram",
    "epiphany",
    "eponym",
    "equitable",
    "equivocate",
    "ersatz",
    "estimable",
    "ethereal",
    "evanescent",
    "excoriate",
    "execrate",
    "exegesis",
    "exemplar",
    "exiguity",
    "exorbitant",
    "expansive",
    "expunge",
    "expurgate",
    "extrapolate",
    "facile",
    "factious",
    "factitious",
    "feckless",
    "fecund",
    "fell",
    "firebrand",
    "flag",
    "flippant",
    "flummox",
    "fractious",
    "gaffe",
    "gambit",
    "gerrymander",
    "graft",
    "grandiloquent",
    "gumption",
    "hagiographic",
    "hail",
    "halcyon",
    "hauteur",
    "hector",
    "hedge",
    "histrionic",
    "hoary",
    "hobble",
    "hoodwink",
    "hubris",
    "illustrious",
    "imbibe",
    "imbroglio",
    "immure",
    "impecunious",
    "imperious",
    "impervious",
    "impetuous",
    "importuned",
    "improvident",
    "impugn",
    "impute",
    "inanity",
    "inchoate",
    "incontrovertible",
    "indigent",
    "indigent",
    "ineffable",
    "ineluctable",
    "inequity",
    "infelicitous",
    "inimitable",
    "insouciance",
    "insufferable",
    "internecine",
    "intimation",
    "inure",
    "invective",
    "invidious",
    "inviolable",
    "inviolate",
    "irrefutable",
    "jaundice",
    "jejune",
    "jejune",
    "jingoist",
    "and",
    "juggernaut",
    "kowtow",
    "lacerate",
    "lachrymose",
    "lampoon",
    "languish",
    "lascivious",
    "limpid",
    "litany",
    "loath",
    "lugubrious",
    "machinate",
    "magisterial",
    "malapropism",
    "malfeasance",
    "malingerer",
    "martinet",
    "maudlin",
    "maunder",
    "maunder",
    "mellifluous",
    "mendicant",
    "meteoric",
    "mettlesome",
    "misattribute",
    "modicum",
    "mordant",
    "moribund",
    "mulct",
    "nadir",
    "nettlesome",
    "noisome",
    "nonchalant",
    "objurgate",
    "oblique",
    "obstreperous",
    "obtain",
    "obtuse",
    "officious",
    "ossify",
    "overweening",
    "palatable",
    "palaver",
    "palimpsest",
    "panacea",
    "panegyric",
    "paragon",
    "paragon",
    "pariah",
    "parvenu",
    "patent",
    "pecuniary",
    "pellucid",
    "penurious",
    "penurious",
    "percipient",
    "peremptory",
    "perfunctory",
    "peripatetic",
    "perspicacious",
    "phantasmagorical",
    "philistine",
    "phlegmatic",
    "picayune",
    "pillory",
    "pith",
    "plucky",
    "Pollyannaish",
    "ponderous",
    "pontificate",
    "portentous",
    "precipitate",
    "precipitate",
    "presentiment",
    "primacy",
    "probity",
    "prognostication",
    "prolixity",
    "promulgate",
    "propitiate",
    "prosaic",
    "proscribe",
    "proselytize",
    "protean",
    "provident",
    "puerile",
    "puissant",
    "punctilious",
    "pyrrhic",
    "quail",
    "quisling",
    "quixotic",
    "raconteur",
    "raillery",
    "rapprochement",
    "rarefied",
    "recapitulation",
    "recrimination",
    "recrudesce",
    "redoubtable",
    "remonstrate",
    "reprisal",
    "ribald",
    "row",
    "sagacious",
    "sangfroid",
    "sardonic",
    "sartorial",
    "saturnine",
    "schadenfreude",
    "sedulous",
    "self-effacing",
    "semblance",
    "sententious",
    "simulacrum",
    "simulacrum",
    "sinecure",
    "solecism",
    "solicitous",
    "solicitude",
    "spartan",
    "splenetic",
    "squelch",
    "stalwart",
    "stultify",
    "subterfuge",
    "supercilious",
    "surfeit",
    "surreptitious",
    "sybarite",
    "temerity",
    "tempestuous",
    "tendentious",
    "transmute",
    "trenchant",
    "truculence",
    "truculent",
    "turgid",
    "turpitude",
    "tyro",
    "umbrage",
    "unassailable",
    "unflappable",
    "unforthcoming",
    "unimpeachable",
    "unprepossessing",
    "unpropitious",
    "unstinting",
    "untenable",
    "untoward",
    "untrammeled",
    "unviable",
    "vaunted",
    "venial",
    "verisimilitude",
    "veritable",
    "vicissitude",
    "vitriol",
    "vitriolic",
    "vituperate",
    "zeitgeist",
  ]

  document.addEventListener("DOMContentLoaded", function (e) {
    var width = 100, height = 100;
    var maincolor = "#F4B400";
    var svg = d3.select("body").append("svg");
    var force = d3.layout.force().gravity(.05).distance(100).charge(-100);
    var datanodes = [], datalinks = [], i = 1;
    var delta = 0;
    var radius = 10;

    function getMeta(metaName) {
      var metas = document.getElementsByTagName('meta');

      for (let i = 0; i < metas.length; i++) {
        if (metas[i].getAttribute('name') === metaName) {
          return metas[i].getAttribute('content');
        };
      }
      return '';
    };

    var splithyphen = getMeta("split-hyphen");
    var data = JSON.parse(getMeta("data"));
    var topn = getMeta("number-of-neighbours");
    var linkstrokewidth = getMeta("link-stroke-width");
    var pages = JSON.parse(getMeta("pages"));
    var threshold = getMeta("threshold");


    function buildGraph(inlinks, innodes) {
      d3.selectAll(".link").remove();
      d3.selectAll(".node").remove();
      d3.selectAll("circle").remove();
      var links = inlinks;
      force.nodes(innodes).links(inlinks).linkDistance(function (d) {
        var dv = d.value * 100;
        var df = Math.log(dv);
        var koef = isFinite(df) ? df : 1;
        return dv * koef + radius;
      }).start();
      var linksel = svg.selectAll(".link").data(inlinks);
      var link = linksel.enter().append("line").attr("stroke", "#aaa").style("stroke-width", linkstrokewidth || 1);
      var nodesel = svg.selectAll(".node").data(innodes);
      var node = nodesel.enter().append("g").call(force.drag);
      node.append("circle").attr("fill", function (d) {
        if (d.color == maincolor) return d.color;
        if (word_list.includes(d.name)) {
          return d.color;
        }
        else {
          return "#32CD32	";
        }
      }).style("stroke", "black").style("stroke-width", function (d) {
        return d.page ? 3 : 0;
      }).attr("r", function (d) {
        return d.color == maincolor ? radius * 1.5 : radius;
      }).on("mouseover", function (d, i) {
        if (word_list.includes(d.name)) {
          d3.select(this).on("click", function (d) {
            window.open("../" + d.name + "/index.html", "graphIFrame");
          });
        }
      });
      node.append("text").text(function (d) {
        return splithyphen === 'true' ? d.name.split("_")[0] : d.name;
      }).on("mouseover", function (d, i) {
        if (word_list.includes(d.name)) {
          d3.select(this).
            on("click", function (d) {
              window.open("../" + d.name + "/index.html", "graphIFrame");
            });
        }
      }).attr("stroke", "#333").attr("dx", 12).attr("dy", ".35em").style("cursor", "default");
      nodesel.exit().remove();
      force.on("tick", function () {
        link.attr("x1", function (d) {
          return d.source.x;
        }).attr("y1", function (d) {
          return d.source.y;
        }).attr("x2", function (d) {
          return d.target.x;
        }).attr("y2", function (d) {
          return d.target.y;
        });
        node.attr("transform", function (d) {
          return "translate(" + d.x + "," + d.y + ")";
        });
      });
    }
    width = window.innerWidth, height = window.innerHeight;
    svg.attr("width", width).attr("height", height);
    force.size([width, height]);
    var order = {};
    order[data[0]["source"]] = 0;
    datanodes.push({ "name": data[0]["source"], color: maincolor });
    for (var k, k = 1; k < data.length; k++) {
      var dif = 1 - data[k]["value"];
      if (delta && delta > dif || !delta) {
        delta = dif;
      }
      var key = data[k]["target"];
      var src = 0;
      var tg = k;
      if (k > topn) {
        src = order[data[k]["source"]];
        tg = order[data[k]["target"]];
      } else {
        datanodes.push({ "name": data[k]["target"], color: "#041b83", page: pages.indexOf(data[k]["target"]) > -1 });
        order[key] = k;
      }
      if (data[k]["value"] > threshold) {
        datalinks.push({ "source": src, "target": tg, "value": dif, "key": key });
      }
    }
    buildGraph(datalinks, datanodes);
  });

}).call(this)